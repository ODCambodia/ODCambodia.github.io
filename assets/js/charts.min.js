"use strict";let url,resourceId,unknown_text="";const popupString=[];"en"==document.documentElement.lang?(url="https://data.opendevelopmentcambodia.net/en/api/3/action/datastore_search",resourceId="50d26fc8-e451-4486-9252-6cdf09a34fea",unknown_text="Not found",popupString.developer="Project developer (Agency / Company):",popupString.investment="Capital investment:",popupString.million_dollar="millions USD",popupString.project_type="Development project:",popupString.sector="Sector:"):(url="https://data.opendevelopmentcambodia.net/km/api/3/action/datastore_search",resourceId="2515b02f-3e0e-48af-8d58-219cc97a5b0b",unknown_text="ពុំមានព័ត៌មាន",popupString.developer="អ្នកអភិវឌ្ឍន៍គម្រោង៖",popupString.investment="ទុនវិនិយោគ៖",popupString.million_dollar="លានដុល្លារ",popupString.project_type="គម្រោងអភិវឌ្ឍន៍៖",popupString.sector="វិស័យ៖");const limit=1e3,datasetUrl=url+"?resource_id="+resourceId+"&limit=1000";let projects=[];const chartHeightScale=.55,pieXscale=1.41,pieRscale=.275,projectsByCoordinateMapChart=dc_leaflet.markerChart("#cluster-map-anchor"),projectsBySectorPieChart=new dc.PieChart("#projects-by-sector-pie-chart"),projectsByProvincePieChart=new dc.PieChart("#projects-by-province-pie-chart"),investmentByNationalityRowChart=new dc.RowChart("#investment-by-nationality-row-chart"),investmentBySectorRowChart=new dc.RowChart("#investment-by-sector-row-chart");function setHeight(e){return .55*e.width()}try{d3.json(datasetUrl).then(e=>(e.result.records.forEach(e=>{let t={project_name:e.pro_name,project_type:e.dev_pro,developer:e.pro_dev,project_url:e.link_p,sector:e.sector,investment_mm:e.cap_inv_m,investment:e.cap_inv,nationality:e.nat_pro?e.nat_pro:unknown_text,job_creation:e.job_creat,year_start:e.year?e.year:unknown_text,director_name:e.dir_name?e.dir_name:unknown_text,province:e.pro_loc,data_classification:e.data_c,reference:e.reference,lat:e.lat,lng:e.long};projects.push(t)}),projects)).then(e=>{let t=crossfilter(e),r=t.groupAll(),o=t.dimension(e=>[e.lat,e.lng,]),n=t.dimension(e=>e.sector),i=t.dimension(e=>e.sector),a=t.dimension(e=>e.sector);t.dimension(e=>e.investment_mm);let p=t.dimension(e=>e.province),c=t.dimension(e=>e.nationality),l=t.dimension(e=>[e.sector,e.developer,e.project_type,e.investment_mm,e.nationality,e.year_start,]),s=o.group().reduce((e,t)=>(e.lat=t.lat,e.lng=t.lng,e.project_type=t.project_type,e.developer=t.developer,e.project_url=t.project_url,e.sector=t.sector,e.investment_mm=t.investment_mm,e.nationality=t.nationality,e.province=t.province,++e.count,e),(e,t)=>(--e.count,e),()=>({count:0})),d=n.group().reduceCount(),u=i.group().reduceSum(e=>e.investment_mm),m=p.group().reduceCount(),g=c.group().reduceSum(e=>e.investment_mm),h=l.group();projectsByCoordinateMapChart.dimension(o).group(s).map(map).valueAccessor(e=>e.value.count).showMarkerTitle(!1).fitOnRender(!0).fitOnRedraw(!0).filterByArea(!0).cluster(!0).popup(e=>`<p>${popupString.developer} <a target="_blank" href="`+e.value.project_url+'">'+e.value.developer+"</a></p>"+`<p>${popupString.investment} <strong>`+e.value.investment_mm+` ${popupString.million_dollar}</strong></p>`+`<p>${popupString.project_type} <strong>`+e.value.project_type+"</strong></p>"+`<p>${popupString.sector} <strong>`+e.value.sector+"</strong></p>").clusterOptions({spiderfyOnMaxZoom:!0,spiderLegPolylineOptions:{weight:1,color:"#000",opacity:.8}}),projectsBySectorPieChart.dimension(n).group(d).useViewBoxResizing(!0).height(setHeight(projectsBySectorPieChart)-30).cx(projectsBySectorPieChart/1.41).radius(.275*projectsBySectorPieChart).innerRadius(40).externalLabels(500).legend(dc.legend().gap(Math.round(.03*projectsBySectorPieChart.height(),1)).highlightSelected(!0)),investmentBySectorRowChart.dimension(a).group(u).height(setHeight(investmentBySectorRowChart)-10).cap(8).useViewBoxResizing(!0).elasticX(!0).ordering(e=>-e.value).xAxis().ticks(5),projectsByProvincePieChart.dimension(p).group(m).height(setHeight(projectsByProvincePieChart)-30).cx(projectsByProvincePieChart/1.41).radius(.275*projectsByProvincePieChart).slicesCap(7).useViewBoxResizing(!0).innerRadius(40).externalLabels(500).legend(dc.legend().gap(Math.round(.03*projectsByProvincePieChart.height(),1)).highlightSelected(!0).autoItemWidth(!0)),investmentByNationalityRowChart.dimension(c).group(g).useViewBoxResizing(!0).height(setHeight(investmentByNationalityRowChart)-10).cap(8).elasticX(!0).ordering(function(e){return-e.value}).xAxis().ticks(6);let v=dc.dataCount(".dc-datatable-count"),y=dc.tableview("#fim-datatable"),$=[{title:"Project Name",data:e=>e.project_name},{title:"Development project",data:e=>e.project_type},{title:"Project developer (Agency/Company)",data:e=>e.developer},{title:"Nationality of project (Country)",data:e=>e.nationality},{title:"Capital investment (millions USD)",data:e=>e.investment_mm},{title:"Started year",data:e=>e.year_start},{title:"Project location",data:e=>e.province}],j=[{title:"ឈ្មោះគម្រោង",data:e=>e.project_name},{title:"គម្រោងអភិវឌ្ឍន៍",data:e=>e.project_type},{title:"អ្នកអភិវឌ្ឍន៍គម្រោង (ទីភ្នាក់ងារ/ក្រុមហ៊ុន)",data:e=>e.developer},{title:"ប្រទេសអភិវឌ្ឍគម្រោង",data:e=>e.nationality},{title:"ទុនវិនិយោគ (លានដុល្លារ)",data:e=>e.investment_mm},{title:"គម្រោងចាប់ផ្តើម",data:e=>e.year_start},{title:"ទីតាំងគម្រោង",data:e=>e.province}],C="en"==document.documentElement.lang?$:j;v.crossfilter(t).groupAll(r),y.dimension(l).group(h).columns(C).size(25).enableColumnReordering(!0).enablePaging(!0).enablePagingSizeChange(!0).enableSearch(!0).enableAutoWidth(!0).enableHeader(!0).fixedHeader(!0).enableScrolling(!1).scrollingOptions({scrollY:1/0,scrollCollapse:!0,deferRender:!0}).groupBy(e=>e.sector).showGroups(!0).select(!0).buttons(["csv","excel","print"]),dc.renderAll()})}catch(e){console.log(e)}
