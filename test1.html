<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
    <title>DC.js + Leaflet</title>

    <meta itemprop="name" content="DC.js + Leaflet" />
    <meta itemprop="description" content="DC.js + Leaflet chart" />

    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="node_modules/leaflet/dist/leaflet.css">
    <link rel="stylesheet" type="text/css" href="node_modules/leaflet.markercluster/dist/MarkerCluster.css">
    <link rel="stylesheet" type="text/css" href="node_modules/dc/dist/style/dc.min.css">

    <style>
        #holder {
            width: 850px;
            margin: 20px auto;
        }

        #holder>div {
            padding: 30px 0;
            clear: both;
        }

        .map {
            width: 600px;
            height: 400px;
        }

        .pie {
            margin-left: 30px;
        }
    </style>
</head>

<body>

    <div id="holder">
        <div id="demo1">
            <h2>Markers with clustering, popups and single selection</h2>
            <i>Renewable energy plants in Bulgaria in 2012</i>
            <div class="map"></div>
            <div class="pie"></div>
        </div>

        <div id="demo2">
            <h2>Markers with no clustering and selection by area</h2>
            <i>Renewable energy plants in Bulgaria in 2012</i>
            <div class="map"></div>
            <div class="pie"></div>
        </div>

        <div id="demo3">
            <h2>Le choropleth</h2>
            <i>Population by age groups in Bulgaria in 2011 (excluding the capital)</i>
            <div class="map"></div>
            <div class="pie"></div>
        </div>
    </div>

    <script type="text/javascript" src="assets/js/d3.js"></script>
    <script type="text/javascript" src="assets/js/crossfilter.js"></script>
    <script type="text/javascript" src="assets/js/dc.js"></script>
    <script type="text/javascript" src="node_modules/leaflet/dist/leaflet.js"></script>

    <!--Optional-->
    <script type="text/javascript" src="node_modules/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <script type="text/javascript" src="node_modules/dc.leaflet/dc.leaflet.min.js"></script>
    <script type="text/javascript">

        /*     Markers      */

        d3.tsv("assets/demo1.tsv", function (data) {
            drawMarkerSelect(data);
            drawMarkerArea(data);
        });

        function drawMarkerSelect(data) {
            var xf = crossfilter(data);
            var groupname = "marker-select";
            var facilities = xf.dimension(function (d) { return d.geo; });
            var facilitiesGroup = facilities.group().reduceCount();



            var types = xf.dimension(function (d) { return d.type; });
            var typesGroup = types.group().reduceCount();

            dc.pieChart("#demo1 .pie", groupname)
                .dimension(types)
                .group(typesGroup)
                .width(200)
                .height(200)
                .renderLabel(true)
                .renderTitle(true)
                .ordering(function (p) {
                    return -p.value;
                });

            dc.renderAll(groupname);
        }
    </script>


    <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = "//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>

</body>

</html>